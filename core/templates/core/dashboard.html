{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard • UnruffledAI</title>

    <!-- Core Theme Styles (same as login) -->
    <link rel="stylesheet" href="{% static 'css/auth.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="dark-bg">

<!-- NAVIGATION BAR -->
<header class="navbar">
    <div class="nav-left">
        <img src="{% static 'img/logo.png' %}" class="nav-logo">
        <span class="nav-title">UnruffledAI</span>
    </div>

    <nav class="nav-links">
        <a href="/dashboard/" class="active">Dashboard</a>
        <a href="/reports/">Reports</a>
        <a href="/natal/{{ profile.full_name }}/">Natal Chart</a>
        <a href="/settings/">Settings</a>
        <a href="/logout/" class="logout-btn">Logout</a>
    </nav>
</header>


<!-- MAIN DASHBOARD CONTENT -->
<div class="dashboard-wrapper">

    <!-- Greeting -->
    <h1 class="welcome-text">Good afternoon, {{ profile.full_name }}</h1>
    <p class="sub-text">Here’s your wellness overview for today</p>

    <button id="openBiometricModal" class="primary-btn">+ Add Biometric Data</button>


    <!-- CARD GRID -->
    <div class="grid-container">

        <!-- Burnout Gauge Card -->
        <div class="card">
            <h2 class="card-title">Your Burnout Risk</h2>
            <canvas id="burnoutGauge" class="gauge"></canvas>
            <p class="gauge-score">{{ combined_risk }}%</p>
        </div>

        <!-- Biometrics -->
        <div class="card">
            <h2 class="card-title">Latest Biometrics</h2>

            {% if latest_biometric %}
            <ul class="info-list">
                <li><span>Heart Rate:</span> {{ latest_biometric.heart_rate }} bpm</li>
                <li><span>HRV Score:</span> {{ latest_biometric.hrv_score }}</li>
                <li><span>Sleep Hours:</span> {{ latest_biometric.sleep_hours }}</li>
                <li><span>Stress Level:</span> {{ latest_biometric.stress_level }}</li>
            </ul>
            {% else %}
            <p class="empty-text">No biometric data available yet.</p>
            {% endif %}
        </div>

        <!-- AI Prediction -->
        <div class="card">
            <h2 class="card-title">Latest AI Prediction</h2>

            {% if latest_prediction %}
                <p><strong>Burnout Level:</strong> {{ latest_prediction.predicted_burnout_level }}</p>
                <p><strong>Risk Score:</strong> {{ latest_prediction.prediction_burnout_risk|floatformat:2 }}%</p>
                <p><strong>Factors:</strong> {{ latest_prediction.contributing_factors }}</p>

                <a href="{{ latest_prediction.meditation_link }}" class="link-btn" target="_blank">
                    View meditation resource
                </a>

            {% else %}
                <p class="empty-text">No predictions yet.</p>
            {% endif %}
        </div>

        <!-- Transit Alerts -->
        <div class="card">
            <h2 class="card-title">Astrological Transit Alerts</h2>

            {% if transit_alerts %}
                <ul class="info-list">
                    {% for t in transit_alerts %}
                        <li>
                            <strong>{{ t.transit_planet }}</strong> entering House {{ t.natal_house }}
                            <div class="transit-desc">{{ t.description }}</div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-text">No active transits today.</p>
            {% endif %}

            <a href="/share-team/" class="share-link">Share with your team →</a>
        </div>

    </div>

</div>


<!-- BIOMETRIC MODAL -->
<div id="biometricModal" class="modal">
    <div class="modal-content">
        <h2>Add Biometric Data</h2>

        <form method="POST" action="{% url 'add_biometric' %}">
            {% csrf_token %}

            <label>Heart Rate</label>
            <input type="number" name="heart_rate" required>

            <label>HRV Score</label>
            <input type="number" name="hrv_score" required>

            <label>Sleep Hours</label>
            <input type="number" name="sleep_hours" required>

            <label>Activity Level</label>
            <input type="number" name="activity_level" required>

            <label>Stress Level</label>
            <input type="number" name="stress_index" required>

            <div class="modal-buttons">
                <button class="primary-btn" type="submit">Save</button>
                <button class="secondary-btn" type="button" id="closeBiometricModal">Cancel</button>
            </div>
        </form>
    </div>
</div>



<!-- SCRIPTS -->
<script>
new Chart(document.getElementById("burnoutGauge"), {
    type: "doughnut",
    data: {
        datasets: [{
            data: [{{ combined_risk }}, {{ remaining_risk }}],
            backgroundColor: ["#ff6d6d", "rgba(255,255,255,0.1)"],
            borderWidth: 0
        }]
    },
    options: {
        cutout: "30%",
        plugins: { legend: { display: false } }
    }
});

// Modal logic
const modal = document.getElementById("biometricModal");
document.getElementById("openBiometricModal").onclick = () => modal.style.display = "flex";
document.getElementById("closeBiometricModal").onclick = () => modal.style.display = "none";
</script>

</body>
</html>

